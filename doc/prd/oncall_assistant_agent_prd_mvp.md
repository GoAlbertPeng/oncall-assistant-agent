# OnCall助手Agent 产品需求文档（PRD）- MVP 版本

## 文档基础信息

| 项目     | 内容                                                         |
|----------|--------------------------------------------------------------|
| 产品名称 | OnCall助手Agent                                          |
| 产品版本 | MVP 1.0                                                      |
| 目标用户 | 运维工程师、研发OnCall人员、SRE工程师                        |
| 核心价值 | **验证核心假设**：大模型能否有效辅助告警根因分析与快速定位问题 |

---

## 一、MVP 产品概述

### 1.1 产品定位

面向 OnCall 场景的**最小可用智能助手**：用户输入告警信息后，系统从 1-2 类数据源拉取上下文，通过大模型分析给出根因与处理建议，并支持生成简单工单。MVP 聚焦验证「多源数据 + 大模型分析」的核心价值，暂不做复杂权限、审批、报表。

### 1.2 MVP 核心目标

1. **验证价值**：大模型是否能有效辅助告警根因分析；
2. **打通闭环**：告警输入 → 上下文收集 → 分析输出 → 工单生成；
3. **可演示**：能向内部团队演示完整流程，收集真实反馈。

## 二、MVP 核心功能模块

### 2.1 模块1：用户管理

| 功能点   | 需求描述                                             |
|----------|------------------------------------------------------|
| 登录     | 邮箱 + 密码登录；无注册，账号由管理员预置            |
| 权限校验 | 仅校验是否登录，不区分角色                           |
| 登出     | 支持登出并清除会话                                   |

**排除项**：注册、个人中心、角色权限、操作审计。

---

### 2.2 模块2：数据源管理（2 类）

| 数据源类型   | 录入/管理需求                                                                 |
|--------------|-------------------------------------------------------------------------------|
| 日志数据源   | 1. 支持类型：ELK 或 Loki；<br>2. 字段：名称、类型、访问地址、端口、认证 Token、日志索引/路径；<br>3. 操作：新增、编辑、删除、测试连通性；<br>4. 不要求业务域分类。 |
| Prometheus   | 1. 字段：名称、Prometheus 地址、认证 Token（可选）；<br>2. 操作：新增、编辑、删除、测试连通性；<br>3. 不要求指标预览。 |



---

### 2.3 模块3：智能告警分析（核心）

| 功能点             | 需求描述                                                                 |
|--------------------|--------------------------------------------------------------------------|
| 告警信息输入       | 1. 聊天框手动输入告警文本（如「支付服务 CPU 使用率 99%，持续 5 分钟」）；<br>2. 不要求批量导入、自动提取关键信息。 |
| 数据源上下文收集   | 1. 用户提交后，自动执行：<br> - 日志源：按告警时间范围、告警对象检索相关日志（错误/关键日志）；<br> - Prometheus：查询告警指标历史曲线；<br>2. 收集结果展示给用户，支持简单筛选（如排除无关日志）；不要求手动补充。 |
| 大模型分析与根因   | 1. 输入：告警信息 + 数据源上下文；<br>2. 输出：根因结论 + 简要证据（引用日志/指标）；<br>3. 根因类型：代码问题、配置问题、资源瓶颈、依赖故障（可选分类）。 |
| 解决建议输出       | 1. 文本形式输出临时缓解方案 + 根本解决方案；<br>2. 不要求关联 SOP、用户反馈、可视化步骤拆解。 |

---

### 2.4 模块4：工单管理

| 功能点       | 需求描述                                                                 |
|--------------|--------------------------------------------------------------------------|
| 工单生成     | 1. 告警分析完成后，提供「生成工单」按钮；<br>2. 工单字段：工单号（OC+日期+序号）、告警标题、根因结论、故障等级（P1/P2/P3）、处理人（默认当前用户）；<br>3. 支持编辑后提交。 |
| 工单状态     | 1. 状态：新建、处理中、已完结；<br>2. 仅支持状态变更，无审批流程；<br>3. 无邮件触发、站内信。 |
| 工单列表     | 1. 列表展示工单号、标题、状态、处理人、创建时间；<br>2. 支持按状态、时间范围筛选；<br>3. 点击进入工单详情。 |

**排除项**：邮件触发、审批、协同人、预计解决时间、批量操作、数据报表。

---

### 2.5 模块5：数据持久化（基础）

| 数据类型     | 存储与查询需求                                                       |
|--------------|----------------------------------------------------------------------|
| 用户信息     | 存储：id、email、password（加密）、create_time、last_login_time；预置账号。 |
| 会话信息     | 存储：session_id、user_id、告警内容、上下文、分析结果、创建时间；支持按时间、关键词检索；列表 + 详情查看。 |
| 工单数据     | 存储：工单号、告警 id、处理人、状态、创建时间、完结时间；支持按状态、时间筛选。 |

**排除项**：多角色查询权限、全文检索、导出 PDF/Excel、数据报表、自动备份、3 年保留策略。

---

## 三、MVP 非功能需求（放宽）

| 维度     | 完整版要求                          | MVP 要求                                  |
|----------|-------------------------------------|-------------------------------------------|
| 性能     | 上下文收集 ≤10s，分析 ≤30s          | 同左，可适当放宽至 60s                     |
| 并发     | ≥200 在线，≥50 请求/分钟            | 支持 5-10 人同时使用即可                   |
| 可靠性   | 99.99% 存储成功率                   | 核心流程可用，单点故障可接受               |
| 安全     | HTTPS、MD5+盐、审计、防注入         | HTTPS、密码加密存储、基础 XSS/SQL 防护     |
| 兼容性   | 多浏览器、1920×1080                 | Chrome 最新版，1920×1080                   |
| 存储     | MySQL + MongoDB + Redis             | **仅 MySQL**（会话/上下文用 JSON 字段存储）|

---

## 四、MVP 技术简化建议

| 原设计              | MVP 建议                                           |
|---------------------|----------------------------------------------------|
| MySQL + MongoDB     | 仅 MySQL，会话与分析结果用 JSON/TEXT 字段          |
| Redis 缓存          | 可选，登录态可用 JWT 无状态                         |
| 多模型适配          | 固定 1 个大模型（如 GPT-4 或通义）                  |
| 邮件服务            | 不做，工单仅站内展示                                |

---

## 五、MVP 交互流程（核心）

```
1. 用户登录
   ↓
2. 进入「告警分析」页
   ↓
3. 输入告警信息 → 点击「分析」
   ↓
4. 展示数据源收集进度（日志/Prometheus）
   ↓
5. 展示分析结果：根因 + 证据 + 建议（纯文本）
   ↓
6. 点击「生成工单」→ 编辑工单 → 提交
   ↓
7. 工单列表可查看、更新状态
```

**数据源配置**：独立「数据源管理」页，支持新增/编辑/删除/测试连通性，在告警分析前完成配置。

---

## 六、MVP 验收标准

| 项目         | 标准                                                 |
|--------------|------------------------------------------------------|
| 功能完整性   | 登录 → 配置数据源 → 输入告警 → 获取分析结果 → 生成工单，全流程可跑通 |
| 核心体验     | 分析结果包含根因 + 简要证据 + 处理建议，具备参考价值   |
| 可用性       | 支持 5 人以内内部试用，无明显阻塞问题                  |
| 交付物       | 可部署的 Web 应用，附带基础部署文档                    |

---

## 七、总结

MVP 版 PRD 将 OnCall 助手的核心路径收敛为：**告警输入 → 2 类数据源上下文 → 大模型分析 → 文本结果 + 简单工单**。目标是快速验证「大模型 + 多源数据」在 OnCall 场景的价值，再基于反馈迭代扩展数据源、工单流转、可视化等能力。
